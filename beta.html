<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Arnie++</title>
        <meta name="description" content="Beer Vending Machine">

        <link rel="stylesheet" href="beta.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

    <script>


    var alreadyConnected=false;
    var sessionStarted = false;

        $(function(){

            if(!alreadyConnected){

                $.ajax({
                    url: "/connect",
                    cache: false,
                    type: 'GET'
                }).done(function(data) {
                    alreadyConnected=true;
                    console.log("connected to machine", data);
                });

            };

            $('#startSession').click(function(){
                $.ajax({
                    url: "/startsession",
                    cache: false,
                    type: 'GET'
                }).done(function(data) {
                    sessionStarted = true;
                    // $('#sessionStatus').addClass('active').text('Active');
                    console.log("debug.html: started session", data);
                });
            });

            $('#endSession').click(function(){
                $.ajax({
                    url: "/endsession",
                    cache: false,
                    type: 'GET'
                }).done(function(data) {
                    sessionStarted = false;
                    // $('#sessionStatus').removeClass('active').text('Inactive');
                    console.log("debug.html: ended session", data);
                });
            });

            // Submit the debug form
            $('#debugForm').submit(function(event){
                var hex = $(this).find(':input').val();
                $('#request').text("You entered: "+hex);

                $.ajax({
                    url: "sendRequest",
                    data: {"hex":hex}
                }).done(function(data, textStatus, jqXHR){
                    $('#response').text(data);
                    console.log('success data',data);
                    console.log('success textStatus',textStatus);
                    console.log('success jqXHR',jqXHR);
                }).fail(function(jqXHR, textStatus, errorThrown){
                    console.log('fail jqXHR',jqXHR);
                    console.log('fail textStatus',textStatus);
                    console.log('fail errorThrown',errorThrown);
                    $('#response').text(jqXHR.responseText);
                })
                event.preventDefault();
            });

        });


       </script>
    </head>
    <body>
        <div class="ribbon"><div class="ribbon--inner">Beta</div></div>
        <div class="counter">
          <h3 class="counter--title">Game Over</h3>
          <span class="counter--number">10</span>
        </div>
        <div class="primaryContent wrapper">
          <h1>Hi, I am Arnie!</h1>
          <p class="intro">Can I get you a beer?</p>
          <p><button id="startSession" class="primary">Beer Me!</button></p>
          <div class="cancelContent">
            <h2 class="cancelContent--title">Change your mind?</h2>
            <p><button id="endSession" class="danger">Cancel</button></p>
          </div>
        </div>
        <footer class="wrapper">
          <h3>What's this <em>beta</em> business?</h3>
          <p>We are working hard to upgrade Arnie with some cool new features. In the mean time, please be patient and let us know if you expreience any issues. Email Chris Heinen (cheinen@arn.com) if Arnie misbehaves.</p>
        </footer>
    </body>
</html>
