<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Arnie++</title>
        <meta name="description" content="Beer Vending Machine">

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <style>
        pre {
            width:50%;
        }
    </style>
    <script>


    var alreadyConnected=false;
    var sessionStarted = false;

        $(function(){
            if(!alreadyConnected){

                $.ajax({
                    url: "http://localhost:3000/connect",
                    cache: false,
                    crossDomain: true
                }).done(function(data) {
                    alreadyConnected=true;
                    console.log("connected to machine", data);
                });

            }


            // setInterval(function(){ //CHECKING SESSION
            //     $.ajax({
            //         url: "http://localhost:3000/checkSession",
            //         cache: false,
            //         crossDomain: true
            //     }).done(function(data) {
            //         data = data + '';
            //         sessionStarted = (data.indexOf("true")!=-1);
            //         console.log("Session started? ", data.indexOf("true")!=-1);
            //     });
            // },500);

            // Submit the debug form
            $('#debugForm').submit(function(event){
                var hex = $(this).find(':input').val();
                $('#request').text("Your hex was: "+hex);
                $.ajax({
                    url: "sendRequest",
                    data: {"hex":hex}
                }).done(function(data, textStatus, jqXHR){
                    $('#response').text(data);
                }).fail(function(jqXHR, textStatus, errorThrown){
                    console.log('jqXHR',jqXHR);
                    console.log('textStatus',textStatus);
                    console.log('errorThrown',errorThrown);
                    $('#response').text(jqXHR.responseText);
                })
                event.preventDefault();
            });
        });


       </script>
    </head>
    <body>
        <h1>Debug Terminal</h1>
        <p>Send Hex Codes to PC2MDB cashless device. </p>
        <form id="debugForm">
            <input type="text" name="hex">
            <input type="submit">
        </form>
        <h2>Request</h2>
        <p id="request"></p>
        <h2>Response</h2>
        <pre id="response"></pre>
    </body>
</html>
